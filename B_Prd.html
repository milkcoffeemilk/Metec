<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>產品維護頁面</title>
    <!-- 引入預編譯的 Tailwind CSS 檔案 -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <!-- 引入共通 CSS 樣式 -->
    <link rel="stylesheet" href="common_styles.css">
    <!-- 引入設定檔 (必須在 liff_utils.js 之前) -->
    <script src="config.js"></script>
    <!-- 引入共通 JavaScript 函數 -->
    <script src="liff_utils.js"></script>
</head>
<body>

    <h1>產品維護 V1.0</h1>
    <div id="operatorNameDisplay">🔄 載入操作者資訊...</div>

    <form id="productForm">
        <label for="productCode">產品編號:</label>
        <input type="number" name="productCode" id="productCode" placeholder="請輸入產品編號" min="1000000" max="3999999" step="1" required>

        <label for="productName">產品名稱:</label>
        <input type="text" name="productName" id="productName" placeholder="請輸入產品名稱" required>

        <!-- 銷售價格欄位已移除 -->
        <!-- 庫存數量欄位已移除 -->

        <label for="operator">操作者 (自動填入):</label>
        <input type="text" name="operator" id="operator" required readonly>

        <label for="recordDate">維護日期:</label>
        <input type="date" name="recordDate" id="recordDate" required>

        <button type="submit" id="submitButton">送出資料</button>
    </form>

    <div id="statusMessage" class="message"></div>

    <script>
        // 請替換成你的 LIFF ID (此頁面專屬)
        const liffId = "2007824757-mOkx2arK"; 
        // GAS 部署網址將從 config.js 獲取

        const operatorNameDisplay = document.getElementById("operatorNameDisplay");
        const operatorInput = document.getElementById("operator");
        const recordDateInput = document.getElementById("recordDate");
        const productForm = document.getElementById("productForm");
        const productCodeInput = document.getElementById("productCode");
        const productNameInput = document.getElementById("productName");
        const submitButton = document.getElementById("submitButton");
        const statusMessage = document.getElementById("statusMessage");

        // 頁面初始化函數
        async function initPage() {
            try {
                // initLiffAndGetProfile 會在內部查詢實際名字並設定顯示，同時將 LINE 名稱填入 input
                await initLiffAndGetProfile(liffId, operatorNameDisplay, operatorInput);
                recordDateInput.value = getTodayDateString();

            } catch (err) {
                showStatusMessage(statusMessage, "❌ 頁面初始化失敗，請重新載入。", "error", false);
                console.error("產品頁面初始化錯誤:", err);
            }
        }

        // 提交成功後的回呼函數
        function onProductSubmitSuccess() {
            productCodeInput.value = "";
            productNameInput.value = "";
            productCodeInput.focus(); 
        }

        // 監聽表單提交事件
        productForm.addEventListener("submit", (e) => {
            e.preventDefault();
            handleFormSubmission(
                productForm, 
                submitButton, 
                statusMessage, 
                APP_CONFIG.gasScriptURL, // 使用 APP_CONFIG.gasScriptURL
                "submitProductData", 
                onProductSubmitSuccess
            );
        });

        // 啟動頁面初始化
        initPage();
    </script>
</body>
</html>
