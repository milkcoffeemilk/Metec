<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>請假表單</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>請假表單</h2>
  <form id="leaveForm">
    <label>姓名：</label>
    <input type="text" id="name" name="name" readonly><br><br>

    <label>請假日期：</label>
    <input type="date" name="date"><br><br>

    <label>請假事由：</label>
    <textarea name="reason" rows="3" cols="30"></textarea><br><br>

    <button type="submit">送出</button>
  </form>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycby3N_qQnVZYApMQbZy7UW2sDWFgFVD7d1if8gBem2hKYUN9YAzods2Al-c9GWAw6LqD1Q/exec";

    async function main() {
      await liff.init({ liffId: "2007824757-mvngBGAJ" });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const profile = await liff.getProfile();
      document.getElementById("name").value = profile.displayName;

      document.getElementById("leaveForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        formData.append("userId", profile.userId);

        fetch(scriptURL, {
          method: "POST",
          body: formData,
        })
        .then(response => {
          alert("已送出！");
          liff.closeWindow(); // 可選擇性關閉 LIFF 視窗
        })
        .catch(error => {
          console.error("錯誤:", error);
          alert("送出失敗");
        });
      });
    }

    main().catch(err => {
      console.error("初始化失敗:", err);
    });
  </script>
</body>
</html>
